---
layout: post
title: "Social Cam简要分析报告"
categories: [iOS, Social, OpenGLES]
comments: true
---
##SocialCam部分研究结果报告20120525

####SocialCam的一些设计(忽略用户使用层面)

* 关于数据
	* 大量数据缓存至数据库(用户头像url/用户视频缩略图/推荐视频缩略图)
	* 所有数据尽可能的以关系连接分表保存
	* 导出视频数据为mov文件

* 关于视频速度
	* 视频合成后期的动画效果时并没有实时的生成合成后的文件
	* 同上, 后期合成时音乐也没有实时的叠加在上面
	* 视频的合成也是很慢的, 但是这个过程放在了后台, 用户根本感觉不到

* 关于上传
	* 当用户开始拍摄是就会生成一个plist文件保存以下信息:
		* 每个视频在没有上传前以1970年至今的秒的数字来区分并存储在本地
		* 在视频开始上传时更名为服务器分配的一个唯一的名字(比如"AUrSpxZj.mov")
		* 里面的数据大致有:
			* 视频所处的状态(比如拍摄中,tag页面,编辑页面,后台上传队列)
			* 每个视频长度/本地url/类别/特效/音效分类等
			* 缩略图本地路径/长宽
			* 上传进度
			* 经纬度
			* 其他一些常用信息
	* 直到视频编辑页面, 此时未开始上传
	* 用户点击保存之后, 视频开始合成, 合成完毕后开始上传
	* 视屏按照200kb的大小分段上传
	* 每个chunck的信息大致有:
		* hash值
		* hash是否已经通过验证
		* 视频大小(byte)
		* index
		* 上传开始时间
		* 上传结束时间
		* 是否正在上传
	* 估计上传的流程是:
		1. 一个个上传这些chunck
		2. 每次上传完成后与服务器共同hash验证是否正确, 如果正确继续下一段
		3. 如果出现中断等情况, 直接从最后一次验证正确的chunck之后继续上传

* 其他:
	* 用到了一个很流行的自动化部署的工具:testflight

####总结:

* 有必要研究一下testflight来增加分发app以及多部门测试的方便程度和效率
* 不合成直接叠加播放视频的技术现在还不知道怎么实现的(这样用户才能在根本感觉不到卡的情况, 如果需要合成的话, 这个压制视频的过程是很长的)
* 上传的流程值得借鉴
* 部分细节设计(如数据库的设计/后台队列上传)值得借鉴

####To be continued